---
import BaseLayout from './BaseLayout.astro'
import LanguagePicker from '../components/i18n/LanguagePicker.astro'
import { useTranslatedPath, useTranslations, validateLang } from '../i18n/utils'
import Trans from '../components/i18n/Trans.astro'
import { Icon } from 'astro-icon/components'

interface Props {
  title?: string
  description?: string
}

const { title, description } = Astro.props
const { lang } = Astro.params
validateLang(lang)
const localizePath = useTranslatedPath(lang)
const t = useTranslations(lang)
---
<BaseLayout title={title} description={description}>
    <slot name="head" slot="head"/>

    <div class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="border-b border-[--color-border] bg-[--color-surface]">
            <div x-data="{ open: false }" class="max-w-4xl mx-auto px-4 sm:px-6 h-16 flex items-center justify-between">
                <!-- Logo / Name -->
                <a href={localizePath('/')} class="text-lg font-medium text-[--color-text-primary] hover:text-[--color-text-secondary]">
                    Timothée Rebours
                </a>

                <!-- Desktop Navigation -->
                <nav class="hidden md:flex items-center gap-8">
                    <a href={localizePath('/blog')} class="text-[--color-text-secondary] hover:text-[--color-text-primary]">
                        {t('layout.blog')}
                    </a>
                    <a href={localizePath('/about-me')} class="text-[--color-text-secondary] hover:text-[--color-text-primary]">
                        {t('layout.about-me')}
                    </a>
                    <LanguagePicker class="text-sm text-[--color-text-secondary] bg-transparent border-none cursor-pointer hover:text-[--color-text-primary]"/>
                </nav>

                <!-- Mobile Menu Button -->
                <button
                    @click="open = !open"
                    class="md:hidden p-2 text-[--color-text-secondary] hover:text-[--color-text-primary]"
                    aria-label="Menu"
                >
                    <Icon name="carbon:menu" class="w-6 h-6" x-show="!open"/>
                    <Icon name="carbon:close" class="w-6 h-6" x-show="open" x-cloak/>
                </button>

                <!-- Mobile Navigation Overlay -->
                <div
                    x-show="open"
                    x-cloak
                    x-transition:enter="transition ease-out duration-200"
                    x-transition:enter-start="opacity-0"
                    x-transition:enter-end="opacity-100"
                    x-transition:leave="transition ease-in duration-150"
                    x-transition:leave-start="opacity-100"
                    x-transition:leave-end="opacity-0"
                    class="fixed inset-0 top-16 bg-surface z-50 md:hidden"
                >
                    <nav class="flex flex-col items-center justify-center h-full gap-8 text-2xl">
                        <a href={localizePath('/blog')} class="text-[--color-text-primary] hover:text-[--color-text-secondary]">
                            {t('layout.blog')}
                        </a>
                        <a href={localizePath('/about-me')} class="text-[--color-text-primary] hover:text-[--color-text-secondary]">
                            {t('layout.about-me')}
                        </a>
                        <LanguagePicker class="text-lg text-[--color-text-secondary] bg-transparent border-none"/>
                    </nav>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-1">
            <slot/>
        </main>

        <!-- Footer -->
        <footer class="border-t border-[--color-border] py-12 mt-16">
            <div class="max-w-4xl mx-auto px-4 sm:px-6 text-center">
                <p class="text-sm text-[--color-text-secondary] mb-4">
                    Timothée Rebours
                </p>
                <div class="flex justify-center gap-6 mb-4">
                    <a href="https://github.com/tex0l" target="_blank" rel="noopener" class="text-[--color-text-muted] hover:text-[--color-text-primary]" aria-label="GitHub">
                        <Icon name="mdi:github" class="w-5 h-5"/>
                    </a>
                    <a href="https://www.linkedin.com/in/trebours/" target="_blank" rel="noopener" class="text-[--color-text-muted] hover:text-[--color-text-primary]" aria-label="LinkedIn">
                        <Icon name="mdi:linkedin" class="w-5 h-5"/>
                    </a>
                    <a href="https://twitter.com/ReboursT" target="_blank" rel="noopener" class="text-[--color-text-muted] hover:text-[--color-text-primary]" aria-label="Twitter">
                        <Icon name="mdi:twitter" class="w-5 h-5"/>
                    </a>
                    <a href={localizePath('/rss.xml')} class="text-[--color-text-muted] hover:text-[--color-text-primary]" aria-label="RSS">
                        <Icon name="mdi:rss" class="w-5 h-5"/>
                    </a>
                </div>
                <p class="text-xs text-[--color-text-muted]">
                    <Trans keyPath="layout.hosted-at">
                        <a href="https://github.com/tex0l/tex0l.github.io" rel="noopener" class="underline hover:text-[--color-text-secondary]">{t('layout.available-here')}</a>
                    </Trans>
                    <span class="mx-2">·</span>
                    <a href={localizePath('/privacy')} class="underline hover:text-[--color-text-secondary]">{t('privacy.title')}</a>
                </p>
            </div>
        </footer>
    </div>
</BaseLayout>
