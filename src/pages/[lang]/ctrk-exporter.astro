---
import 'leaflet/dist/leaflet.css'
import Layout from '~/layouts/Layout.astro'
import { languages } from '~/i18n/index.ts'
import { useTranslations, useTranslatedPath, validateLang } from '~/i18n/utils'
import { createBreadcrumbSchema } from '~/utils/breadcrumb'
import FileUpload from '@tex0l/ctrk-astro/components/FileUpload.vue'
import AnalyzePage from '@tex0l/ctrk-astro/components/AnalyzePage.vue'
import Toast from '@tex0l/ctrk-astro/components/Toast.vue'

export function getStaticPaths (): Array<{ params: { lang: string } }> {
  return Object.keys(languages).map(lang => ({ params: { lang } }))
}

const { lang } = Astro.params
validateLang(lang)
const t = useTranslations(lang)
const localizePath = useTranslatedPath(lang)

const breadcrumbSchema = createBreadcrumbSchema(lang, Astro.url.origin, [
  { name: t('projects.title'), url: localizePath('/projects') },
  { name: t('ctrk-exporter.title') }
])
---
<Layout title={t('ctrk-exporter.title')} description={t('ctrk-exporter.description')}>
    <Fragment slot="head">
        <meta property="og:type" content="website" />
        <meta property="og:image" content={`${Astro.url.origin}/og/${lang}-ctrk-exporter.png`} />
        <meta name="twitter:image" content={`${Astro.url.origin}/og/${lang}-ctrk-exporter.png`} />
        <script is:inline type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />
    </Fragment>

    <div class="max-w-5xl mx-auto px-4 sm:px-6 py-16">
        <header class="mb-12 text-center">
            <h1 class="text-4xl font-semibold tracking-tight mb-4">
                {t('ctrk-exporter.h1')}
            </h1>
            <p class="text-lg text-[--color-text-secondary] leading-relaxed max-w-2xl mx-auto">
                {t('ctrk-exporter.subtitle')}
            </p>
        </header>

        <FileUpload client:only="vue" />
        <AnalyzePage client:only="vue" />
    </div>

    <Toast client:only="vue" />
</Layout>

